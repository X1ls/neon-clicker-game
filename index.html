<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Krunker Clone JS</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        #crosshair {
            position: absolute; top: 50%; left: 50%;
            width: 10px; height: 10px; border: 2px solid white;
            border-radius: 50%; transform: translate(-50%, -50%);
            pointer-events: none; z-index: 10;
        }
        #ui {
            position: absolute; bottom: 20px; left: 20px;
            color: white; font-size: 24px; text-shadow: 2px 2px black;
            pointer-events: none;
        }
        #instructions {
            position: absolute; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); color: white;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; text-align: center;
        }
    </style>
</head>
<body>

    <div id="instructions">
        <h1>OYUNA BAŞLAMAK İÇİN TIKLA</h1>
        <p>(W,A,S,D ile hareket, Mouse ile bakış ve ateş)</p>
    </div>
    <div id="crosshair"></div>
    <div id="ui">HP: 100 | SKOR: 0</div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // --- SAHNE VE AYARLAR ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb); // Gökyüzü mavisi
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- IŞIKLANDIRMA ---
        const light = new THREE.HemisphereLight(0xeeeeee, 0x888888, 1);
        scene.add(light);

        // --- ZEMİN VE DÜNYA ---
        const grid = new THREE.GridHelper(100, 50, 0x000000, 0x555555);
        scene.add(grid);
        const floorGeo = new THREE.PlaneGeometry(100, 100);
        const floorMat = new THREE.MeshPhongMaterial({ color: 0x228b22 });
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        scene.add(floor);

        // Hedefler (Düşmanlar)
        const targets = [];
        function createTarget(x, z) {
            const geo = new THREE.BoxGeometry(2, 4, 2);
            const mat = new THREE.MeshLambertMaterial({ color: 0xff0000 });
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set(x, 2, z);
            scene.add(mesh);
            targets.push(mesh);
        }
        createTarget(10, -10);
        createTarget(-15, -20);

        // --- KONTROLLER ---
        const controls = new PointerLockControls(camera, document.body);
        const instructions = document.getElementById('instructions');
        instructions.addEventListener('click', () => controls.lock());
        controls.addEventListener('lock', () => instructions.style.display = 'none');
        controls.addEventListener('unlock', () => instructions.style.display = 'flex');

        // Hareket Değişkenleri
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
        const velocity = new THREE.Vector3();
        const direction = new THREE.Vector3();

        const onKeyDown = (e) => {
            switch (e.code) {
                case 'KeyW': moveForward = true; break;
                case 'KeyA': moveLeft = true; break;
                case 'KeyS': moveBackward = true; break;
                case 'KeyD': moveRight = true; break;
            }
        };
        const onKeyUp = (e) => {
            switch (e.code) {
                case 'KeyW': moveForward = false; break;
                case 'KeyA': moveLeft = false; break;
                case 'KeyS': moveBackward = false; break;
                case 'KeyD': moveRight = false; break;
            }
        };
        document.addEventListener('keydown', onKeyDown);
        document.addEventListener('keyup', onKeyUp);

        // --- ATEŞ ETME MEKANİZMASI ---
        const raycaster = new THREE.Raycaster();
        document.addEventListener('mousedown', () => {
            if (!controls.isLocked) return;
            
            // Ekranın ortasından ışın gönder
            raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);
            const intersects = raycaster.intersectObjects(targets);

            if (intersects.length > 0) {
                const hit = intersects[0].object;
                hit.material.color.set(0xffff00); // Vurunca sarı yap
                setTimeout(() => scene.remove(hit), 100); // 100ms sonra sil
            }
        });

        // --- OYUN DÖNGÜSÜ ---
        let prevTime = performance.now();
        function animate() {
            requestAnimationFrame(animate);
            if (controls.isLocked) {
                const time = performance.now();
                const delta = (time - prevTime) / 1000;

                velocity.x -= velocity.x * 10.0 * delta;
                velocity.z -= velocity.z * 10.0 * delta;

                direction.z = Number(moveForward) - Number(moveBackward);
                direction.x = Number(moveRight) - Number(moveLeft);
                direction.normalize();

                if (moveForward || moveBackward) velocity.z -= direction.z * 400.0 * delta;
                if (moveLeft || moveRight) velocity.x -= direction.x * 400.0 * delta;

                controls.moveRight(-velocity.x * delta);
                controls.moveForward(-velocity.z * delta);

                prevTime = time;
            }
            renderer.render(scene, camera);
        }
        animate();

        // Pencere Boyutu Ayarı
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
